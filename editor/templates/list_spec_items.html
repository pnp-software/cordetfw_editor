{% extends "base_generic.html" %}

{% load ref_filters %}

{% block content %}
<div class="col-11">
<div class="jumbotron jumbotron-fluid bg-transparent mb-n3">
  <h2 class="display-6">List of {{config.name}}s in {{val_set.name}} ValSet</h2>  
    <div class="form-inline">
      <div class="dropdown mr-sm-2 mt-4">
        <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-toggle="dropdown">Select ValSet</button>
        <div class="dropdown-menu">
            {% for val_set in val_sets %}
                <a class="dropdown-item" href="{% url 'list_spec_items' cat project.id application_id val_set.id sel_dom %}">{{ val_set.name }}</a>
            {% endfor %}
        </div>
      </div>
      <div class="dropdown mr-sm-2 mt-4">
        <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-toggle="dropdown">Select Domain</button>
        <div class="dropdown-menu">
            {% for domain in domains %}
                <a class="dropdown-item" href="{% url 'list_spec_items' cat project.id application_id val_set.id domain %}">{{ domain }}</a>
            {% endfor %}
        </div>
      </div>
      <div class="dropdown mr-sm-2 mt-4">
        <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-toggle="dropdown">Import/Export</button>
        <div class="dropdown-menu">
            <a class="dropdown-item" href="{% url 'export_spec_items' cat project.id application_id val_set.id sel_dom %}">
                Plain Export</a>
            <a class="dropdown-item" href="{% url 'export_spec_items' cat project.id application_id val_set.id sel_dom %}?export=latex_format">
                Export for Latex</a>
            <a class="dropdown-item" href="{% url 'import_spec_items' cat project.id application_id val_set.id sel_dom %}">
                Plain Import</a>
        </div>
      </div>
      <div class="dropdown mr-sm-2 mt-4">
        <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-toggle="dropdown">Traceability</button>
        <div class="dropdown-menu">
            <a class="dropdown-item" href="{% url 'list_spec_items' cat project.id application_id val_set.id sel_dom %}">
                {{config.name}}s to Verification Items</a>
            <a class="dropdown-item" href="{% url 'list_spec_items' cat project.id application_id val_set.id sel_dom %}">
                Verification Items to {{config.name}}s</a>
        </div>
      </div>
      <div class="form-group mr-sm-2 mt-4">
        <a class="btn btn-outline-secondary" href="{% url 'add_spec_item' cat project.id application_id sel_dom %}">Add {{config.name}}</a>
      </div>
    </div>
</div>

    <table class="table table-hover table-striped table-sm">
      <thead>
        <tr class="table-warning">
          <th>{{config.attrs.domain.label}}</th>
          <th>{{config.attrs.name.label}}</th>
          
          <!-- Title and: description, rationale, and remarks -->
          {% if 'title' in display_list or 'desc' in display_list or 'rationale' in display_list or 'remarks' in display_list %}
          <th>{{config.attrs.desc.label}}</th>
          {% endif %}
          
          <!-- For data items: value, NValue, unit of measure and multiplicity -->
          {% if cat == 'DataItem'  %}
            {% if 'value' in display_list %}
            <th>{{config.attrs.value.label}}</th>
            <th>NVal</th>
            {% endif %}
            {% if 't2' in display_list %}
            <th>{{config.attrs.t2.label}}</th>
            {% endif %}
            {% if 't1' in display_list %}
            <th>{{config.attrs.t1.label}}</th>
            {% endif %}
          {% endif %}
          
          <!-- For non-data items: value and, underneath, the five text fields  -->          
          {% if cat != 'DataItem' %}
            {% if 'value' in display_list %}
            <th>{{config.attrs.value.label}}</th>
            {% endif %}
          {% endif %}

          <!-- The p_kind and s_kind  -->          
          {% if 'p_kind' in display_list %}
          <th>{{config.attrs.p_kind.label}}</th>
          {% endif %}
          {% if 's_kind' in display_list %}
          <th>{{config.attrs.s_kind.label}}</th>
          {% endif %}

          <!-- The generic integer fields  -->          
          {% if 'n1' in display_list %}
          <th>{{config.attrs.n1.label}}</th>
          {% endif %}
          {% if 'n2' in display_list %}
          <th>{{config.attrs.n2.label}}</th>
          {% endif %}
          {% if 'n3' in display_list %}
          <th>{{config.attrs.n3.label}}</th>
          {% endif %}

          <!-- The p_link and s_link  -->          
          {% if 'p_link' in display_list %}
          <th>{{config.attrs.p_link.label}}</th>
          {% endif %}
          {% if 's_link' in display_list %}
          <th>{{config.attrs.s_link.label}}</th>
          {% endif %}
          
          {% if 'owner' in display_list %}
          <th>Owner</th>
          {% endif %}
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for item in items %}
           <tr>
            <td><a name='{{item.domain}}:{{item.name}}'>{{item.domain}}</a></td>
            <td>{{item.name}}</td>
            
            <!-- Title and: description, rationale, and remarks -->
            {% if 'title' in display_list %}
            <td><strong>{{item.title}}</strong> 
            {% endif  %}
                {% if item.desc != '' and 'desc' in display_list %}
                {{item.desc|filter_refs|linebreaksbr}}
                {% endif %}
                {% if item.rationale != '' and 'rationale' in display_list %}
                <br><strong>Rationale</strong> {{item.rationale|filter_refs|linebreaksbr}}
                {% endif %}
                {% if item.remarks != '' and 'remarks' in display_list %}
                <br><strong>Remarks</strong> {{item.remarks|filter_refs|linebreaksbr}}
                {% endif %}
            </td>
            
            <!-- For data items: value, NValue, unit of measure and multiplicity -->
            {% if cat == 'DataItem' %}
                {% if 'value' in display_list %}
                <td>{{item.value|filter_refs|linebreaksbr}}</td>
                <td>{{item.value|filter_di_value|linebreaksbr}}</td>
                {% endif %}
                {% if 't2' in display_list %}
                <td>{{item.t2}}</td>
                {% endif %}
                {% if 't1' in display_list %}
                <td>{{item.t1}}</td>
                {% endif %}
            {% endif %}
            
            <!-- For non-data items: value and, underneath, the five text fields  -->          
            {% if cat != 'DataItem' %}
                {% if 'value' in display_list %}
                <td>{{item.value|filter_refs|linebreaksbr}}
                {% endif  %}
                {% if 't1' in display_list %}
                <br><strong>{{config.attrs.t1.label}}</strong>{{item.t1|filter_refs|linebreaksbr}}
                {% endif  %}
                {% if 't2' in display_list %}
                <br><strong>{{config.attrs.t2.label}}</strong>{{item.t2|filter_refs|linebreaksbr}}
                {% endif  %}
                {% if 't3' in display_list %}
                <br><strong>{{config.attrs.t3.label}}</strong>{{item.t3|filter_refs|linebreaksbr}}
                {% endif  %}
                </td>
            {% endif %}
            
            <!-- The p_kind and s_kind  -->          
            {% if 'p_kind' in display_list %}
            <td>{{item.p_kind}}</td>
            {% endif %}
            {% if 's_kind' in display_list %}
            <td>{{item.s_kind}}</td>
            {% endif %}
            
            <!-- The generic integer fields  -->          
            {% if 'n1' in display_list %}
            <td>{{item.n1}}</td>
            {% endif %}
            {% if 'n2' in display_list %}
            <td>{{item.n2}}</td>
            {% endif %}
            {% if 'n3' in display_list %}
            <td>{{item.n3}}</td>
            {% endif %}

            <!-- The p_link and s_link  -->          
            {% if 's_link' in display_list %}
            <td><a href="{% url 'list_spec_items' item.s_link.cat project.id application_id val_set.id item.s_link.domain %}#{{item.s_link.domain}}:{{item.s_link.name}}" 
                title="{{item.s_link.domain}}: {{item.s_link.title}}">
                {{item.s_link.name}}
                </a>
            </td>
            {% endif %}
            {% if 'p_link' in display_list %}
            <td><a href="{% url 'list_spec_items' item.p_link.cat project.id application_id val_set.id item.p_link.domain %}#{{item.p_link.domain}}:{{item.p_link.name}}" 
                title="{{item.p_link.domain}}: {{item.p_link.title}}">
                {{item.p_link.name}}
                </a>
            </td>
            {% endif %}

            {% if 'owner' in display_list %}
            <td>{{item.owner}}</td>
            {% endif %}
            <td>
              <div class="btn-group">
                {% if item.val_set.name == 'Default' %}  
                <a class="btn btn-outline-dark btn-sm"
                   href="{% url 'copy_spec_item' cat project.id application_id item.id sel_dom %}" title="Copy {{config.name}}">C</a>
                <a class="btn btn-outline-dark btn-sm"
                   href="{% url 'split_spec_item' cat project.id application_id item.id sel_dom %}" title="Split {{config.name}}">S</a>
                {% endif %}
                <a class="btn btn-outline-dark btn-sm"
                   href="{% url 'del_spec_item' cat project.id application_id item.id sel_dom %}" title="Delete {{config.name}}">D</a>
                <a class="btn btn-outline-dark btn-sm"
                   href="{% url 'edit_spec_item' cat project.id application_id item.id sel_dom %}" title="Edit {{config.name}}">E</a>
                <a class="btn btn-outline-dark btn-sm"
                   href="{% url 'list_spec_item_history' cat project.id application_id item.id sel_dom %}" title="{{config.name}} History">H</a>
                {% if config.expand.s_link != 'None' and val_set.name == 'Default' %}
                <a class="btn btn-outline-dark btn-sm"
                   href="{% url 'list_spec_items' cat project.id application_id val_set.id sel_dom %}?expand_id={{item.id}}&expand_link=s_link" 
                   title="Show {{config.expand.s_label}} Children">Xs</a>
                {% endif %}
                {% if config.expand.p_link != 'None' and val_set.name == 'Default' %}
                <a class="btn btn-outline-dark btn-sm"
                   href="{% url 'list_spec_items' cat project.id application_id val_set.id sel_dom %}?expand_id={{item.id}}&expand_link=p_link" 
                   title="Show {{config.expand.p_label}} Children">Xp</a>
                {% endif %}
                {% if expand_link == 's_link' and val_set.name == 'Default' %}
                <a class="btn btn-outline-dark btn-sm"
                   href="{% url 'add_spec_item' config.expand.s_link project.id application_id sel_dom %}?s_parent_id={{item.id}}" 
                   title="Add {{config.expand.s_label}} Child">As</a>
                {% endif %}
                {% if expand_link == 'p_link' and val_set.name == 'Default' %}
                <a class="btn btn-outline-dark btn-sm"
                   href="{% url 'add_spec_item' config.expand.p_link project.id application_id sel_dom %}?p_parent_id={{item.id}}" 
                   title="Add {{config.expand.p_label}} Child">Ap</a>
                {% endif %}
              </div> 
            </td>
          </tr>
          {% if item.id == expand_id %}
            {% for expand_item in expand_items %}
            <tr class="table-active">
              <td><a name='expand:{{expand_item.domain}}:{{expand_item.name}}'>{{expand_item.domain}}</a></td>
              <td><a href="{% url 'list_spec_items' expand_item.cat project.id application_id val_set.id expand_item.domain %}#{{expand_item.domain}}:{{expand_item.name}}"
                            title="{{expand_item.value|filter_di_value|linebreaksbr}}">
                  {{expand_item.name}}
                  </a>
              </td>
              <td>{{expand_item.title}}</td>
              {% for i in n_pad_fields %}
              <td></td>
              {% endfor %}
              <td>
                <div class="btn-group">  
                  {% if expand_link == 'p_link' %}
                    {% if item.val_set.name == 'Default' %}  
                    <a class="btn btn-outline-dark btn-sm"
                       href="{% url 'copy_spec_item' expand_item.cat project.id application_id expand_item.id sel_dom %}?p_parent_id={{item.id}}" 
                       title="Copy {{config.expand.p_label}} Child">C</a>
                    <a class="btn btn-outline-dark btn-sm"
                       href="{% url 'split_spec_item' expand_item.cat project.id application_id expand_item.id sel_dom %}?p_parent_id={{item.id}}" 
                       title="Split {{config.expand.p_label}} Child">S</a>
                    {% endif %}
                    <a class="btn btn-outline-dark btn-sm"
                       href="{% url 'del_spec_item' expand_item.cat project.id application_id expand_item.id sel_dom %}?p_parent_id={{item.id}}" 
                       title="Delete {{config.expand.p_label}} Child">D</a>
                    <a class="btn btn-outline-dark btn-sm"
                       href="{% url 'edit_spec_item' expand_item.cat project.id application_id expand_item.id sel_dom %}?p_parent_id={{item.id}}" 
                       title="Edit {{config.expand.p_label}} Child">E</a>
                  {% endif %}
                  {% if expand_link == 's_link' %}
                    {% if item.val_set.name == 'Default' %}  
                    <a class="btn btn-outline-dark btn-sm"
                       href="{% url 'copy_spec_item' expand_item.cat project.id application_id expand_item.id sel_dom %}?s_parent_id={{item.id}}" 
                       title="Copy {{config.expand.s_label}} Child">C</a>
                    <a class="btn btn-outline-dark btn-sm"
                       href="{% url 'split_spec_item' expand_item.cat project.id application_id expand_item.id sel_dom %}?s_parent_id={{item.id}}" 
                       title="Split {{config.expand.s_label}} Child">S</a>
                    {% endif %}
                    <a class="btn btn-outline-dark btn-sm"
                       href="{% url 'del_spec_item' expand_item.cat project.id application_id expand_item.id sel_dom %}?s_parent_id={{item.id}}" 
                       title="Delete {{config.expand.s_label}} Child">D</a>
                    <a class="btn btn-outline-dark btn-sm"
                       href="{% url 'edit_spec_item' expand_item.cat project.id application_id expand_item.id sel_dom %}?s_parent_id={{item.id}}" 
                       title="Edit {{config.expand.s_label}} Child">E</a>
                  {% endif %}
                </div>
              </td>    
            </tr>
            {% endfor %}
          {% endif %}
        {% endfor %}
      </tbody>
    </table>
</div>
{% endblock %}
